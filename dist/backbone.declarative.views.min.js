// Backbone.Declarative.Views, v3.0.0
// Copyright (c) 2014-2016 Michael Heim, Zeilenwechsel.de
// Distributed under MIT license
// http://github.com/hashchange/backbone.declarative.views


!function(a,b){"use strict";var c="object"==typeof exports&&exports&&!exports.nodeType&&"object"==typeof module&&module&&!module.nodeType;"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(["exports","underscore","backbone"],b):c?b(exports,require("underscore"),require("backbone")):b({},_,Backbone)}(this,function(a,_,Backbone){"use strict";function b(a){var b;return a&&_.isString(a)&&(b=y[a],b||(b=j(a)),b.invalid&&(b=void 0)),b}function c(a){var c,d=a.declarativeViews.meta;return d.processed?c=d.inGlobalCache?b(d.originalTemplateProp):void 0:a.template&&_.isString(a.template)?(c=b(a.template),d.processed=!0,d.inGlobalCache=!0,d.originalTemplateProp=a.template):(c=void 0,d.processed=!0,d.inGlobalCache=!1),c}function d(a){y={},!a&&Backbone.Marionette&&Backbone.Marionette.TemplateCache&&Backbone.Marionette.TemplateCache.clear()}function e(a){var b=!1,c=_.toArray(arguments),d=_.last(c);if(c.length&&_.isBoolean(d)&&(b=c.pop()),c.length>1)_.each(c,function(a){e(a,b)});else if(_.isArray(a)||_.isArguments(a))_.each(a,function(a){e(a,b)});else{if(!a)throw new C("Missing argument: string identifying the template. The string should be a template selector or the raw HTML of a template, as provided to the template property of a view when the cache entry was created");if(_.isString(a)&&(l(a),!b&&Backbone.Marionette&&Backbone.Marionette.TemplateCache))try{Backbone.Marionette.TemplateCache.clear(a)}catch(a){}}}function f(a){var b=a.declarativeViews.meta;b.processed?b.inGlobalCache&&l(b.originalTemplateProp):a.template&&_.isString(a.template)&&l(a.template)}function g(a){var b;try{if(b=G(a),!G.contains(document.documentElement,b[0]))throw new Error}catch(c){if(b=h(a),b.html()!==a)throw new Error("Failed to wrap template string in script tag without altering it")}return b}function h(a){var b=G("<script />").attr("type","text/x-template").text(a),c=i(a);return c&&b.attr(c),b}function i(a){var b={},c=w.exec(a),d=c&&c[0];return d&&_.each(B,function(a,c){var e=a.exec(d),f=e&&e[2];f&&(b[c]=f)}),_.size(b)?b:void 0}function j(a){var b,c,d,e=Backbone.DeclarativeViews.custom.loadTemplate,f=Backbone.DeclarativeViews.defaults.loadTemplate,h=f!==g,i=a;try{b=e?e(a):f(a)}catch(a){if(s(a))throw a;b=""}if((e||h)&&""!==b&&!(b instanceof Backbone.$))throw new F("Invalid return value. The "+(e?"custom":"default")+" loadTemplate function must return a jQuery instance, but it hasn't");return b.length?(c=p(b),d=b.html(),y[i]={html:d,compiled:k(d,b),tagName:c.tagName,className:c.className,id:c.id,attributes:c.attributes}):y[i]={invalid:!0},y[i]}function k(a,b){var c,d=Backbone.DeclarativeViews.custom.compiler;if(d){if(d&&!_.isFunction(d))throw new F("Invalid custom template compiler set in Backbone.DeclarativeViews.custom.compiler: compiler is not a function");try{c=d(a,b)}catch(b){throw new E('An error occurred while compiling the template. The compiler had been passed the HTML string "'+a+'" as the first argument, and the corresponding template node, wrapped in a jQuery object, as the second argument')}}return c}function l(a){y[a]&&delete y[a]}function m(a,b){var c=n(),d="data-"+a,e=b&&b.isJSON?"json":"primitives",f=A[e];if(0===a.indexOf("data-"))throw new F('registerDataAttribute(): Illegal attribute name "'+a+'", must be registered without "data-" prefix');if("html"===a||"compiled"===a)throw new F('registerDataAttribute(): Cannot register attribute name "'+a+'" because it is reserved');if(_.contains(c,a))throw new F('registerDataAttribute(): Cannot register attribute name "'+a+'" because it has already been registered');f.push(a),A[e]=_.uniq(f),B[d]=new RegExp(d+"\\s*=\\s*(['\"])([\\s\\S]+?)\\1"),w=o()}function n(){return A.primitives.concat(A.json)}function o(){return new RegExp("<!--(?:(?!-->)[\\s\\S])*?data-(?:"+n().join("|")+")\\s*=\\s*(['\"])[\\s\\S]+?\\1[\\s\\S]*?-->")}function p(a){return q(a),a.data()}function q(a){var b={},c=[];G.hasData(a[0])&&(_.each(A.primitives,function(d){var e=a.attr("data-"+d);void 0===e?c.push(d):b[t(d)]=e}),_.each(A.json,function(d){var e=a.attr("data-"+d);if(void 0===e)c.push(d);else try{b[t(d)]=G.parseJSON(e)}catch(a){c.push(d)}}),c.length&&a.removeData(c),_.size(b)&&a.data(b))}function r(a,b){a.getCachedTemplate=Backbone.DeclarativeViews.getCachedTemplate,a.clearCachedTemplate=Backbone.DeclarativeViews.clearCachedTemplate,a.clearCache=Backbone.DeclarativeViews.clearCache,a.custom=Backbone.DeclarativeViews.custom,b&&(z.push(b),z=_.unique(z))}function s(a){return a instanceof C||a instanceof D||a instanceof E||a instanceof F}function t(a){return a.replace(/([^-])-([a-z])/g,function(a,b,c){return b+c.toUpperCase()})}function u(a){function b(a){this.message=a,Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack}return b.prototype=new Error,b.prototype.name=a,b.prototype.constructor=b,b}var v,w,x=Backbone.View,y={},z=[],A={primitives:[],json:[]},B={},C=u("Backbone.DeclarativeViews.Error"),D=u("Backbone.DeclarativeViews.TemplateError"),E=u("Backbone.DeclarativeViews.CompilerError"),F=u("Backbone.DeclarativeViews.CustomizationError"),G=Backbone.$;_.extend(Backbone.View.prototype,{tagName:function(){var a=c(this)||{};return a.tagName||"div"},className:function(){var a=c(this)||{};return a.className||void 0},id:function(){var a=c(this)||{};return a.id||void 0},attributes:function(){var a=c(this)||{};return a.attributes||void 0}}),Backbone.View=Backbone.View.extend({constructor:function(a){a&&void 0!==a.template&&(this.template=a.template),this.declarativeViews={meta:{},getCachedTemplate:_.partial(c,this),clearCachedTemplate:_.partial(f,this)},_.each(z,function(a){this[a]=this.declarativeViews},this),x.apply(this,arguments)}}),Backbone.DeclarativeViews={getCachedTemplate:b,clearCachedTemplate:e,clearCache:d,Error:C,TemplateError:D,CompilerError:E,CustomizationError:F,plugins:{registerDataAttribute:m,getDataAttributes:p,updateJqueryDataCache:q,registerCacheAlias:r},defaults:{loadTemplate:g},custom:{loadTemplate:void 0,compiler:void 0},version:"3.0.0"},m("tag-name"),m("class-name"),m("id"),m("attributes",{isJSON:!0}),Backbone.Marionette&&Backbone.Marionette.TemplateCache&&(v=Backbone.Marionette.TemplateCache.clear,Backbone.Marionette.TemplateCache.clear=function(){arguments.length?Backbone.DeclarativeViews.clearCachedTemplate(arguments,!0):Backbone.DeclarativeViews.clearCache(!0),v.apply(this,arguments)}),a.info="Backbone.Declarative.Views has loaded. Don't use the exported value of the module. Its functionality is available inside the Backbone namespace."});
//# sourceMappingURL=backbone.declarative.views.min.js.map