// Backbone.Declarative.Views, v2.2.1
// Copyright (c) 2014-2016 Michael Heim, Zeilenwechsel.de
// Distributed under MIT license
// http://github.com/hashchange/backbone.declarative.views


!function(Backbone,_){"use strict";function a(a){var b;return a&&_.isString(a)&&(b=u[a],b||(b=i(a)),b.invalid&&(b=void 0)),b}function b(b){var c,d=b.declarativeViews.meta;return d.processed?c=d.inGlobalCache?a(d.originalTemplateProp):void 0:b.template&&_.isString(b.template)?(c=a(b.template),d.processed=!0,d.inGlobalCache=!0,d.originalTemplateProp=b.template):(c=void 0,d.processed=!0,d.inGlobalCache=!1),c}function c(a){u={},!a&&Backbone.Marionette&&Backbone.Marionette.TemplateCache&&Backbone.Marionette.TemplateCache.clear()}function d(a){var b=!1,c=_.toArray(arguments),e=_.last(c);if(c.length&&_.isBoolean(e)&&(b=c.pop()),c.length>1)_.each(c,function(a){d(a,b)});else if(_.isArray(a)||_.isArguments(a))_.each(a,function(a){d(a,b)});else{if(!a)throw new z("Missing argument: string identifying the template. The string should be a template selector or the raw HTML of a template, as provided to the template property of a view when the cache entry was created");if(_.isString(a)&&(k(a),!b&&Backbone.Marionette&&Backbone.Marionette.TemplateCache))try{Backbone.Marionette.TemplateCache.clear(a)}catch(a){}}}function e(a){var b=a.declarativeViews.meta;b.processed?b.inGlobalCache&&k(b.originalTemplateProp):a.template&&_.isString(a.template)&&k(a.template)}function f(a){var b;try{if(b=D(a),!D.contains(document.documentElement,b[0]))throw new Error}catch(c){if(b=g(a),b.html()!==a)throw new Error("Failed to wrap template string in script tag without altering it")}return b}function g(a){var b=D("<script />").attr("type","text/x-template").text(a),c=h(a);return c&&b.attr(c),b}function h(a){var b={},c=x.exec(a),d=c&&c[0];return d&&_.each(y,function(a,c){var e=a.exec(d),f=e&&e[2];f&&(b[c]=f)}),_.size(b)?b:void 0}function i(a){var b,c,d,e=Backbone.DeclarativeViews.custom.loadTemplate,g=Backbone.DeclarativeViews.defaults.loadTemplate,h=g!==f,i=a;try{b=e?e(a):g(a)}catch(a){if(p(a))throw a;b=""}if((e||h)&&""!==b&&!(b instanceof Backbone.$))throw new C("Invalid return value. The "+(e?"custom":"default")+" loadTemplate function must return a jQuery instance, but it hasn't");return b.length?(c=m(b),d=b.html(),u[i]={html:d,compiled:j(d,b),tagName:c.tagName,className:c.className,id:c.id,attributes:c.attributes}):u[i]={invalid:!0},u[i]}function j(a,b){var c,d=Backbone.DeclarativeViews.custom.compiler;if(d){if(d&&!_.isFunction(d))throw new C("Invalid custom template compiler set in Backbone.DeclarativeViews.custom.compiler: compiler is not a function");try{c=d(a,b)}catch(b){throw new B('An error occurred while compiling the template. The compiler had been passed the HTML string "'+a+'" as the first argument, and the corresponding template node, wrapped in a jQuery object, as the second argument')}}return c}function k(a){u[a]&&delete u[a]}function l(a,b){var c=b&&b.isJSON?"json":"primitives",d=w[c];d.push(a),w[c]=_.uniq(d)}function m(a){return n(a),a.data()}function n(a){var b={},c=[];D.hasData(a[0])&&(_.each(w.primitives,function(d){var e=a.attr("data-"+d);void 0===e?c.push(d):b[q(d)]=e}),_.each(w.json,function(d){var e=a.attr("data-"+d);if(void 0===e)c.push(d);else try{b[q(d)]=D.parseJSON(e)}catch(a){c.push(d)}}),c.length&&a.removeData(c),_.size(b)&&a.data(b))}function o(a,b){a.getCachedTemplate=Backbone.DeclarativeViews.getCachedTemplate,a.clearCachedTemplate=Backbone.DeclarativeViews.clearCachedTemplate,a.clearCache=Backbone.DeclarativeViews.clearCache,a.custom=Backbone.DeclarativeViews.custom,b&&(v.push(b),v=_.unique(v))}function p(a){return a instanceof z||a instanceof A||a instanceof B||a instanceof C}function q(a){return a.replace(/([^-])-([a-z])/g,function(a,b,c){return b+c.toUpperCase()})}function r(a){function b(a){this.message=a,Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack}return b.prototype=new Error,b.prototype.name=a,b.prototype.constructor=b,b}var s,t=Backbone.View,u={},v=[],w={primitives:[],json:[]},x=/<!--(?:(?!-->)[\s\S])*?data-(?:tag-name|class-name|id|attributes)\s*=\s*(['"])[\s\S]+?\1[\s\S]*?-->/,y={"data-tag-name":/data-tag-name\s*=\s*(['"])([\s\S]+?)\1/,"data-class-name":/data-class-name\s*=\s*(['"])([\s\S]+?)\1/,"data-id":/data-id\s*=\s*(['"])([\s\S]+?)\1/,"data-attributes":/data-attributes\s*=\s*(['"])([\s\S]+?)\1/},z=r("Backbone.DeclarativeViews.Error"),A=r("Backbone.DeclarativeViews.TemplateError"),B=r("Backbone.DeclarativeViews.CompilerError"),C=r("Backbone.DeclarativeViews.CustomizationError"),D=Backbone.$;_.extend(Backbone.View.prototype,{tagName:function(){var a=b(this)||{};return a.tagName||"div"},className:function(){var a=b(this)||{};return a.className||void 0},id:function(){var a=b(this)||{};return a.id||void 0},attributes:function(){var a=b(this)||{};return a.attributes||void 0}}),Backbone.View=Backbone.View.extend({constructor:function(a){a&&void 0!==a.template&&(this.template=a.template),this.declarativeViews={meta:{},getCachedTemplate:_.partial(b,this),clearCachedTemplate:_.partial(e,this)},_.each(v,function(a){this[a]=this.declarativeViews},this),t.apply(this,arguments)}}),Backbone.DeclarativeViews={getCachedTemplate:a,clearCachedTemplate:d,clearCache:c,Error:z,TemplateError:A,CompilerError:B,CustomizationError:C,plugins:{registerDataAttribute:l,getDataAttributes:m,updateJqueryDataCache:n,registerCacheAlias:o},defaults:{loadTemplate:f},custom:{loadTemplate:void 0,compiler:void 0}},l("tag-name"),l("class-name"),l("id"),l("attributes",{isJSON:!0}),Backbone.Marionette&&Backbone.Marionette.TemplateCache&&(s=Backbone.Marionette.TemplateCache.clear,Backbone.Marionette.TemplateCache.clear=function(){arguments.length?Backbone.DeclarativeViews.clearCachedTemplate(arguments,!0):Backbone.DeclarativeViews.clearCache(!0),s.apply(this,arguments)})}(Backbone,_);
//# sourceMappingURL=backbone.declarative.views.min.js.map