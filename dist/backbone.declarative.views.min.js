// Backbone.Declarative.Views, v2.2.1
// Copyright (c) 2014-2016 Michael Heim, Zeilenwechsel.de
// Distributed under MIT license
// http://github.com/hashchange/backbone.declarative.views


!function(a,b){"use strict";var c="object"==typeof exports&&exports&&!exports.nodeType&&"object"==typeof module&&module&&!module.nodeType;"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(["underscore","backbone"],b):c?b(require("underscore"),require("backbone")):b(_,Backbone)}(this,function(_,Backbone){"use strict";function a(a){var b;return a&&_.isString(a)&&(b=x[a],b||(b=i(a)),b.invalid&&(b=void 0)),b}function b(b){var c,d=b.declarativeViews.meta;return d.processed?c=d.inGlobalCache?a(d.originalTemplateProp):void 0:b.template&&_.isString(b.template)?(c=a(b.template),d.processed=!0,d.inGlobalCache=!0,d.originalTemplateProp=b.template):(c=void 0,d.processed=!0,d.inGlobalCache=!1),c}function c(a){x={},!a&&Backbone.Marionette&&Backbone.Marionette.TemplateCache&&Backbone.Marionette.TemplateCache.clear()}function d(a){var b=!1,c=_.toArray(arguments),e=_.last(c);if(c.length&&_.isBoolean(e)&&(b=c.pop()),c.length>1)_.each(c,function(a){d(a,b)});else if(_.isArray(a)||_.isArguments(a))_.each(a,function(a){d(a,b)});else{if(!a)throw new B("Missing argument: string identifying the template. The string should be a template selector or the raw HTML of a template, as provided to the template property of a view when the cache entry was created");if(_.isString(a)&&(k(a),!b&&Backbone.Marionette&&Backbone.Marionette.TemplateCache))try{Backbone.Marionette.TemplateCache.clear(a)}catch(a){}}}function e(a){var b=a.declarativeViews.meta;b.processed?b.inGlobalCache&&k(b.originalTemplateProp):a.template&&_.isString(a.template)&&k(a.template)}function f(a){var b;try{if(b=F(a),!F.contains(document.documentElement,b[0]))throw new Error}catch(c){if(b=g(a),b.html()!==a)throw new Error("Failed to wrap template string in script tag without altering it")}return b}function g(a){var b=F("<script />").attr("type","text/x-template").text(a),c=h(a);return c&&b.attr(c),b}function h(a){var b={},c=v.exec(a),d=c&&c[0];return d&&_.each(A,function(a,c){var e=a.exec(d),f=e&&e[2];f&&(b[c]=f)}),_.size(b)?b:void 0}function i(a){var b,c,d,e=Backbone.DeclarativeViews.custom.loadTemplate,g=Backbone.DeclarativeViews.defaults.loadTemplate,h=g!==f,i=a;try{b=e?e(a):g(a)}catch(a){if(r(a))throw a;b=""}if((e||h)&&""!==b&&!(b instanceof Backbone.$))throw new E("Invalid return value. The "+(e?"custom":"default")+" loadTemplate function must return a jQuery instance, but it hasn't");return b.length?(c=o(b),d=b.html(),x[i]={html:d,compiled:j(d,b),tagName:c.tagName,className:c.className,id:c.id,attributes:c.attributes}):x[i]={invalid:!0},x[i]}function j(a,b){var c,d=Backbone.DeclarativeViews.custom.compiler;if(d){if(d&&!_.isFunction(d))throw new E("Invalid custom template compiler set in Backbone.DeclarativeViews.custom.compiler: compiler is not a function");try{c=d(a,b)}catch(b){throw new D('An error occurred while compiling the template. The compiler had been passed the HTML string "'+a+'" as the first argument, and the corresponding template node, wrapped in a jQuery object, as the second argument')}}return c}function k(a){x[a]&&delete x[a]}function l(a,b){var c=m(),d="data-"+a,e=b&&b.isJSON?"json":"primitives",f=z[e];if(0===a.indexOf("data-"))throw new E('registerDataAttribute(): Illegal attribute name "'+a+'", must be registered without "data-" prefix');if("html"===a||"compiled"===a)throw new E('registerDataAttribute(): Cannot register attribute name "'+a+'" because it is reserved');if(_.contains(c,a))throw new E('registerDataAttribute(): Cannot register attribute name "'+a+'" because it has already been registered');f.push(a),z[e]=_.uniq(f),A[d]=new RegExp(d+"\\s*=\\s*(['\"])([\\s\\S]+?)\\1"),v=n()}function m(){return z.primitives.concat(z.json)}function n(){return new RegExp("<!--(?:(?!-->)[\\s\\S])*?data-(?:"+m().join("|")+")\\s*=\\s*(['\"])[\\s\\S]+?\\1[\\s\\S]*?-->")}function o(a){return p(a),a.data()}function p(a){var b={},c=[];F.hasData(a[0])&&(_.each(z.primitives,function(d){var e=a.attr("data-"+d);void 0===e?c.push(d):b[s(d)]=e}),_.each(z.json,function(d){var e=a.attr("data-"+d);if(void 0===e)c.push(d);else try{b[s(d)]=F.parseJSON(e)}catch(a){c.push(d)}}),c.length&&a.removeData(c),_.size(b)&&a.data(b))}function q(a,b){a.getCachedTemplate=Backbone.DeclarativeViews.getCachedTemplate,a.clearCachedTemplate=Backbone.DeclarativeViews.clearCachedTemplate,a.clearCache=Backbone.DeclarativeViews.clearCache,a.custom=Backbone.DeclarativeViews.custom,b&&(y.push(b),y=_.unique(y))}function r(a){return a instanceof B||a instanceof C||a instanceof D||a instanceof E}function s(a){return a.replace(/([^-])-([a-z])/g,function(a,b,c){return b+c.toUpperCase()})}function t(a){function b(a){this.message=a,Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack}return b.prototype=new Error,b.prototype.name=a,b.prototype.constructor=b,b}var u,v,w=Backbone.View,x={},y=[],z={primitives:[],json:[]},A={},B=t("Backbone.DeclarativeViews.Error"),C=t("Backbone.DeclarativeViews.TemplateError"),D=t("Backbone.DeclarativeViews.CompilerError"),E=t("Backbone.DeclarativeViews.CustomizationError"),F=Backbone.$;_.extend(Backbone.View.prototype,{tagName:function(){var a=b(this)||{};return a.tagName||"div"},className:function(){var a=b(this)||{};return a.className||void 0},id:function(){var a=b(this)||{};return a.id||void 0},attributes:function(){var a=b(this)||{};return a.attributes||void 0}}),Backbone.View=Backbone.View.extend({constructor:function(a){a&&void 0!==a.template&&(this.template=a.template),this.declarativeViews={meta:{},getCachedTemplate:_.partial(b,this),clearCachedTemplate:_.partial(e,this)},_.each(y,function(a){this[a]=this.declarativeViews},this),w.apply(this,arguments)}}),Backbone.DeclarativeViews={getCachedTemplate:a,clearCachedTemplate:d,clearCache:c,Error:B,TemplateError:C,CompilerError:D,CustomizationError:E,plugins:{registerDataAttribute:l,getDataAttributes:o,updateJqueryDataCache:p,registerCacheAlias:q},defaults:{loadTemplate:f},custom:{loadTemplate:void 0,compiler:void 0}},l("tag-name"),l("class-name"),l("id"),l("attributes",{isJSON:!0}),Backbone.Marionette&&Backbone.Marionette.TemplateCache&&(u=Backbone.Marionette.TemplateCache.clear,Backbone.Marionette.TemplateCache.clear=function(){arguments.length?Backbone.DeclarativeViews.clearCachedTemplate(arguments,!0):Backbone.DeclarativeViews.clearCache(!0),u.apply(this,arguments)})});
//# sourceMappingURL=backbone.declarative.views.min.js.map