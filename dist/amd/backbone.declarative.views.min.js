// Backbone.Declarative.Views, v2.0.4
// Copyright (c) 2014-2016 Michael Heim, Zeilenwechsel.de
// Distributed under MIT license
// http://github.com/hashchange/backbone.declarative.views


!function(a,b){"use strict";"object"==typeof exports?module.exports=b(require("underscore"),require("backbone")):"function"==typeof define&&define.amd&&define(["underscore","backbone"],b)}(this,function(_,Backbone){"use strict";return function(Backbone,_){function a(a){var b;return _.isString(a)&&(b=n[a],b||(b=f(a)),b.invalid&&(b=void 0)),b}function b(b){var c,d=b.declarativeViews.meta;return d.processed?c=d.inGlobalCache?a(d.originalTemplateProp):void 0:b.template&&_.isString(b.template)?(c=a(b.template),d.processed=!0,d.inGlobalCache=!0,d.originalTemplateProp=b.template):(c=void 0,d.processed=!0,d.inGlobalCache=!1),c}function c(a){n={},!a&&Backbone.Marionette&&Backbone.Marionette.TemplateCache&&Backbone.Marionette.TemplateCache.clear()}function d(a){var b=!1,c=_.toArray(arguments),e=_.last(c);if(c.length&&_.isBoolean(e)&&(b=c.pop()),c.length>1)_.each(c,function(a){d(a,b)});else if(_.isArray(a)||_.isArguments(a))_.each(a,function(a){d(a,b)});else{if(!a)throw new Error("Missing argument: string identifying the template. The string should be a template selector or the raw HTML of a template, as provided to the template property of a view when the cache entry was created");if(_.isString(a)&&(h(a),!b&&Backbone.Marionette&&Backbone.Marionette.TemplateCache))try{Backbone.Marionette.TemplateCache.clear(a)}catch(f){}}}function e(a){var b=a.declarativeViews.meta;b.processed?b.inGlobalCache&&h(b.originalTemplateProp):a.template&&_.isString(a.template)&&h(a.template)}function f(a){var b,c,d,e,f=Backbone.DeclarativeViews.custom.loadTemplate,h=a;try{b=f?f(a):Backbone.$(a)}catch(l){b=""}if(f&&""!==b&&!(b instanceof Backbone.$))throw new Error("Invalid return value. The custom loadTemplate function must return a jQuery instance, but it hasn't");return b.length?(c=i(b),d=b.html(),e=k(b,d),n[h]={html:d,outerHtml:_.partial(j,h,e[0],e[1]),compiled:g(d,b),tagName:c.tagName,className:c.className,id:c.id,attributes:c.attributes}):n[h]={invalid:!0},n[h]}function g(a,b){var c,d=Backbone.DeclarativeViews.custom.compiler;if(d){if(d&&!_.isFunction(d))throw new Error("Invalid custom template compiler set in Backbone.DeclarativeViews.custom.compiler: compiler is not a function");try{c=d(a,b)}catch(e){throw new Error('An error occurred while compiling the template. The compiler had been passed the HTML string "'+a+'" as the first argument, and the corresponding template node, wrapped in a jQuery object, as the second argument')}}return c}function h(a){n[a]&&delete n[a]}function i(a){if($.hasData(a[0])){a.data({tagName:a.attr("data-tag-name"),className:a.attr("data-class-name"),id:a.attr("data-id")});try{a.data("attributes",$.parseJSON(a.attr("data-attributes")))}catch(b){a.removeData("attributes")}}return a.data()}function j(a,b,c){return b+n[a].html+c}function k(a,b){return void 0===b&&(b=a.html()),a.prop("outerHTML").replace(b,"\n").split("\n")}var l,m=Backbone.View,n={};_.extend(Backbone.View.prototype,{tagName:function(){var a=b(this)||{};return a.tagName||"div"},className:function(){var a=b(this)||{};return a.className||void 0},id:function(){var a=b(this)||{};return a.id||void 0},attributes:function(){var a=b(this)||{};return a.attributes||void 0}}),Backbone.View=Backbone.View.extend({constructor:function(a){a&&void 0!==a.template&&(this.template=a.template),this.declarativeViews={meta:{},getCachedTemplate:_.partial(b,this),clearCachedTemplate:_.partial(e,this)},m.apply(this,arguments)}}),Backbone.DeclarativeViews={getCachedTemplate:a,clearCachedTemplate:d,clearCache:c,custom:{loadTemplate:void 0,compiler:void 0}},Backbone.Marionette&&Backbone.Marionette.TemplateCache&&(l=Backbone.Marionette.TemplateCache.clear,Backbone.Marionette.TemplateCache.clear=function(){arguments.length?Backbone.DeclarativeViews.clearCachedTemplate(arguments,!0):Backbone.DeclarativeViews.clearCache(!0),l.apply(this,arguments)})}(Backbone,_),Backbone.DeclarativeViews});
//# sourceMappingURL=backbone.declarative.views.min.js.map