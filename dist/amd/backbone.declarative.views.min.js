// Backbone.Declarative.Views, v2.2.1
// Copyright (c) 2014-2016 Michael Heim, Zeilenwechsel.de
// Distributed under MIT license
// http://github.com/hashchange/backbone.declarative.views


!function(a,b){"use strict";"object"==typeof exports?module.exports=b(require("underscore"),require("backbone")):"function"==typeof define&&define.amd&&define(["underscore","backbone"],b)}(this,function(_,Backbone){"use strict";return function(Backbone,_){function a(a){var b;return _.isString(a)&&(b=u[a],b||(b=g(a)),b.invalid&&(b=void 0)),b}function b(b){var c,d=b.declarativeViews.meta;return d.processed?c=d.inGlobalCache?a(d.originalTemplateProp):void 0:b.template&&_.isString(b.template)?(c=a(b.template),d.processed=!0,d.inGlobalCache=!0,d.originalTemplateProp=b.template):(c=void 0,d.processed=!0,d.inGlobalCache=!1),c}function c(a){u={},!a&&Backbone.Marionette&&Backbone.Marionette.TemplateCache&&Backbone.Marionette.TemplateCache.clear()}function d(a){var b=!1,c=_.toArray(arguments),e=_.last(c);if(c.length&&_.isBoolean(e)&&(b=c.pop()),c.length>1)_.each(c,function(a){d(a,b)});else if(_.isArray(a)||_.isArguments(a))_.each(a,function(a){d(a,b)});else{if(!a)throw new x("Missing argument: string identifying the template. The string should be a template selector or the raw HTML of a template, as provided to the template property of a view when the cache entry was created");if(_.isString(a)&&(i(a),!b&&Backbone.Marionette&&Backbone.Marionette.TemplateCache))try{Backbone.Marionette.TemplateCache.clear(a)}catch(a){}}}function e(a){var b=a.declarativeViews.meta;b.processed?b.inGlobalCache&&i(b.originalTemplateProp):a.template&&_.isString(a.template)&&i(a.template)}function f(a){return B(a)}function g(a){var b,c,d,e,g=Backbone.DeclarativeViews.custom.loadTemplate,i=Backbone.DeclarativeViews.defaults.loadTemplate,j=i!==f,l=a;try{b=g?g(a):i(a)}catch(a){if(p(a))throw a;b=""}if((g||j)&&""!==b&&!(b instanceof Backbone.$))throw new A("Invalid return value. The "+(g?"custom":"default")+" loadTemplate function must return a jQuery instance, but it hasn't");return b.length?(c=k(b),d=b.html(),e=o(b,d),u[l]={html:d,outerHtml:_.partial(n,l,e[0],e[1]),compiled:h(d,b),tagName:c.tagName,className:c.className,id:c.id,attributes:c.attributes}):u[l]={invalid:!0},u[l]}function h(a,b){var c,d=Backbone.DeclarativeViews.custom.compiler;if(d){if(d&&!_.isFunction(d))throw new A("Invalid custom template compiler set in Backbone.DeclarativeViews.custom.compiler: compiler is not a function");try{c=d(a,b)}catch(b){throw new z('An error occurred while compiling the template. The compiler had been passed the HTML string "'+a+'" as the first argument, and the corresponding template node, wrapped in a jQuery object, as the second argument')}}return c}function i(a){u[a]&&delete u[a]}function j(a,b){var c=b&&b.isJSON?"json":"primitives",d=w[c];d.push(a),w[c]=_.uniq(d)}function k(a){return l(a),a.data()}function l(a){var b={},c=[];B.hasData(a[0])&&(_.each(w.primitives,function(d){var e=a.attr("data-"+d);void 0===e?c.push(d):b[q(d)]=e}),_.each(w.json,function(d){var e=a.attr("data-"+d);if(void 0===e)c.push(d);else try{b[q(d)]=B.parseJSON(e)}catch(a){c.push(d)}}),c.length&&a.removeData(c),_.size(b)&&a.data(b))}function m(a,b){a.getCachedTemplate=Backbone.DeclarativeViews.getCachedTemplate,a.clearCachedTemplate=Backbone.DeclarativeViews.clearCachedTemplate,a.clearCache=Backbone.DeclarativeViews.clearCache,a.custom=Backbone.DeclarativeViews.custom,b&&(v.push(b),v=_.unique(v))}function n(a,b,c){return b+u[a].html+c}function o(a,b){return void 0===b&&(b=a.html()),a.prop("outerHTML").replace(b,"\n").split("\n")}function p(a){return a instanceof x||a instanceof y||a instanceof z||a instanceof A}function q(a){return a.replace(/([^-])-([a-z])/g,function(a,b,c){return b+c.toUpperCase()})}function r(a){function b(a){this.message=a,Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack}return b.prototype=new Error,b.prototype.name=a,b.prototype.constructor=b,b}var s,t=Backbone.View,u={},v=[],w={primitives:[],json:[]},x=r("Backbone.DeclarativeViews.Error"),y=r("Backbone.DeclarativeViews.TemplateError"),z=r("Backbone.DeclarativeViews.CompilerError"),A=r("Backbone.DeclarativeViews.CustomizationError"),B=Backbone.$;_.extend(Backbone.View.prototype,{tagName:function(){var a=b(this)||{};return a.tagName||"div"},className:function(){var a=b(this)||{};return a.className||void 0},id:function(){var a=b(this)||{};return a.id||void 0},attributes:function(){var a=b(this)||{};return a.attributes||void 0}}),Backbone.View=Backbone.View.extend({constructor:function(a){a&&void 0!==a.template&&(this.template=a.template),this.declarativeViews={meta:{},getCachedTemplate:_.partial(b,this),clearCachedTemplate:_.partial(e,this)},_.each(v,function(a){this[a]=this.declarativeViews},this),t.apply(this,arguments)}}),Backbone.DeclarativeViews={getCachedTemplate:a,clearCachedTemplate:d,clearCache:c,Error:x,TemplateError:y,CompilerError:z,CustomizationError:A,plugins:{registerDataAttribute:j,getDataAttributes:k,updateJqueryDataCache:l,registerCacheAlias:m},defaults:{loadTemplate:f},custom:{loadTemplate:void 0,compiler:void 0}},j("tag-name"),j("class-name"),j("id"),j("attributes",{isJSON:!0}),Backbone.Marionette&&Backbone.Marionette.TemplateCache&&(s=Backbone.Marionette.TemplateCache.clear,Backbone.Marionette.TemplateCache.clear=function(){arguments.length?Backbone.DeclarativeViews.clearCachedTemplate(arguments,!0):Backbone.DeclarativeViews.clearCache(!0),s.apply(this,arguments)})}(Backbone,_),Backbone.DeclarativeViews});
//# sourceMappingURL=backbone.declarative.views.min.js.map