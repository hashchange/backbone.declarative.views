// Backbone.Declarative.Views, v2.1.0
// Copyright (c) 2014-2016 Michael Heim, Zeilenwechsel.de
// Distributed under MIT license
// http://github.com/hashchange/backbone.declarative.views


!function(a,b){"use strict";"object"==typeof exports?module.exports=b(require("underscore"),require("backbone")):"function"==typeof define&&define.amd&&define(["underscore","backbone"],b)}(this,function(_,Backbone){"use strict";return function(Backbone,_){function a(a){var b;return _.isString(a)&&(b=s[a],b||(b=g(a)),b.invalid&&(b=void 0)),b}function b(b){var c,d=b.declarativeViews.meta;return d.processed?c=d.inGlobalCache?a(d.originalTemplateProp):void 0:b.template&&_.isString(b.template)?(c=a(b.template),d.processed=!0,d.inGlobalCache=!0,d.originalTemplateProp=b.template):(c=void 0,d.processed=!0,d.inGlobalCache=!1),c}function c(a){s={},!a&&Backbone.Marionette&&Backbone.Marionette.TemplateCache&&Backbone.Marionette.TemplateCache.clear()}function d(a){var b=!1,c=_.toArray(arguments),e=_.last(c);if(c.length&&_.isBoolean(e)&&(b=c.pop()),c.length>1)_.each(c,function(a){d(a,b)});else if(_.isArray(a)||_.isArguments(a))_.each(a,function(a){d(a,b)});else{if(!a)throw new u("Missing argument: string identifying the template. The string should be a template selector or the raw HTML of a template, as provided to the template property of a view when the cache entry was created");if(_.isString(a)&&(i(a),!b&&Backbone.Marionette&&Backbone.Marionette.TemplateCache))try{Backbone.Marionette.TemplateCache.clear(a)}catch(f){}}}function e(a){var b=a.declarativeViews.meta;b.processed?b.inGlobalCache&&i(b.originalTemplateProp):a.template&&_.isString(a.template)&&i(a.template)}function f(a){return Backbone.$(a)}function g(a){var b,c,d,e,g=Backbone.DeclarativeViews.custom.loadTemplate,i=Backbone.DeclarativeViews.defaults.loadTemplate,j=i!==f,l=a;try{b=g?g(a):i(a)}catch(p){if(o(p))throw p;b=""}if((g||j)&&""!==b&&!(b instanceof Backbone.$))throw new x("Invalid return value. The "+(g?"custom":"default")+" loadTemplate function must return a jQuery instance, but it hasn't");return b.length?(c=k(b),d=b.html(),e=n(b,d),s[l]={html:d,outerHtml:_.partial(m,l,e[0],e[1]),compiled:h(d,b),tagName:c.tagName,className:c.className,id:c.id,attributes:c.attributes}):s[l]={invalid:!0},s[l]}function h(a,b){var c,d=Backbone.DeclarativeViews.custom.compiler;if(d){if(d&&!_.isFunction(d))throw new x("Invalid custom template compiler set in Backbone.DeclarativeViews.custom.compiler: compiler is not a function");try{c=d(a,b)}catch(e){throw new w('An error occurred while compiling the template. The compiler had been passed the HTML string "'+a+'" as the first argument, and the corresponding template node, wrapped in a jQuery object, as the second argument')}}return c}function i(a){s[a]&&delete s[a]}function j(a,b){var c=b&&b.isJSON?"json":"primitives",d=t[c];d.push(a),t[c]=_.uniq(d)}function k(a){return l(a),a.data()}function l(a){var b={};$.hasData(a[0])&&(_.each(t.primitives,function(c){b[c]=a.attr("data-"+c)}),a.data(b),_.each(t.json,function(b){try{a.data(b,$.parseJSON(a.attr("data-"+b)))}catch(c){a.removeData(b)}}))}function m(a,b,c){return b+s[a].html+c}function n(a,b){return void 0===b&&(b=a.html()),a.prop("outerHTML").replace(b,"\n").split("\n")}function o(a){return a instanceof u||a instanceof v||a instanceof w||a instanceof x}function p(a){function b(a){this.message=a,Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack}return b.prototype=new Error,b.prototype.name=a,b.prototype.constructor=b,b}var q,r=Backbone.View,s={},t={primitives:[],json:[]},u=p("Backbone.DeclarativeViews.Error"),v=p("Backbone.DeclarativeViews.TemplateError"),w=p("Backbone.DeclarativeViews.CompilerError"),x=p("Backbone.DeclarativeViews.CustomizationError");_.extend(Backbone.View.prototype,{tagName:function(){var a=b(this)||{};return a.tagName||"div"},className:function(){var a=b(this)||{};return a.className||void 0},id:function(){var a=b(this)||{};return a.id||void 0},attributes:function(){var a=b(this)||{};return a.attributes||void 0}}),Backbone.View=Backbone.View.extend({constructor:function(a){a&&void 0!==a.template&&(this.template=a.template),this.declarativeViews={meta:{},getCachedTemplate:_.partial(b,this),clearCachedTemplate:_.partial(e,this)},r.apply(this,arguments)}}),Backbone.DeclarativeViews={getCachedTemplate:a,clearCachedTemplate:d,clearCache:c,Error:u,TemplateError:v,CompilerError:w,CustomizationError:x,plugins:{registerDataAttribute:j,getDataAttributes:k,updateJqueryDataCache:l},defaults:{loadTemplate:f},custom:{loadTemplate:void 0,compiler:void 0}},j("tag-name"),j("class-name"),j("id"),j("attributes",{isJSON:!0}),Backbone.Marionette&&Backbone.Marionette.TemplateCache&&(q=Backbone.Marionette.TemplateCache.clear,Backbone.Marionette.TemplateCache.clear=function(){arguments.length?Backbone.DeclarativeViews.clearCachedTemplate(arguments,!0):Backbone.DeclarativeViews.clearCache(!0),q.apply(this,arguments)})}(Backbone,_),Backbone.DeclarativeViews});
//# sourceMappingURL=backbone.declarative.views.min.js.map